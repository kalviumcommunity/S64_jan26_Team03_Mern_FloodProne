datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String?
  role      Role     @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Optional: User can be subscribed to a location
  locationId Int?
  location   Location? @relation(fields: [locationId], references: [id])

  // ðŸ”¹ Files uploaded by user
  files      File[]
}

model File {
  id        Int      @id @default(autoincrement())
  name      String
  type      String
  size      Int
  path      String

  createdAt DateTime @default(now())

  // ðŸ”¹ Relation to User
  userId    Int
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Location {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  latitude    Float
  longitude   Float
  riskLevel   RiskLevel @default(SAFE)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  users       User[]
  alerts      Alert[]
  weatherLogs WeatherLog[]
}

model Alert {
  id          Int      @id @default(autoincrement())
  type        AlertType
  message     String
  severity    Severity @default(INFO)
  active      Boolean  @default(true)
  createdAt   DateTime @default(now())

  locationId  Int
  location    Location @relation(fields: [locationId], references: [id])
}

model WeatherLog {
  id          Int      @id @default(autoincrement())
  temperature Float?
  rainfall    Float?
  waterLevel  Float?
  recordedAt  DateTime @default(now())

  locationId  Int
  location    Location @relation(fields: [locationId], references: [id])

  @@index([locationId, recordedAt])
}

enum Role {
  USER
  ADMIN
}

enum RiskLevel {
  SAFE
  ADVISORY
  WARNING
  EMERGENCY
}

enum AlertType {
  FLOOD
  HEAVY_RAIN
  DAM_RELEASE
  GENERAL
}

enum Severity {
  INFO
  MODERATE
  CRITICAL
}
